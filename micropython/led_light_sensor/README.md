# ESP32/ESP32-S3 LED Light Sensor (MicroPython)

このプロジェクトは、ESP32/ESP32-S3とMicroPythonを使い、一般的なLEDを簡易的な光センサーとして利用するサンプルです。

## 必要なもの
* ESP32開発ボード（ESP32無印またはESP32-S3）
* **赤色LED 1個**（5mm径推奨）
* ジャンパーワイヤー 2本

## 重要な注意事項
⚠️ **LEDの色が重要です！**
* ✅ **赤色LED**: 最も高感度（強く推奨）
* ⚠️ **黄色・緑色LED**: 感度が低い
* ❌ **青色・白色LED**: 光センサーとして不適

## 回路
ESP32/ESP32-S3 の 2 つの GPIO ピン（この例では GPIO 18 と GPIO 19）に直接 LED を接続します。

### 配線図

```
ESP32/ESP32-S3       LED
┌──────────┐        ┌────────┐
│ GPIO 18  ├────────┤アノード　│ ← 足の長い方
│ GPIO 19  ├────────┤カソード　│ ← 足の短い方
└──────────┘        └────────┘
```

### 接続方法
* **LED のアノード（足の長い方）** → **GPIO 18**
* **LED のカソード（足の短い方）** → **GPIO 19**

### 対応ボード
* ✅ ESP32 (無印)
* ✅ ESP32-S3
* ✅ その他のESP32ファミリー（GPIO18/19が利用可能なもの）



## 使い方

### 基本実行
1. 上記の回路を組みます（**赤色LEDを使用**）
2. Thonny IDEなどの開発環境を使い、`main.py`をESP32に書き込みます
3. プログラムが実行されると、以下のような出力が表示されます：

```
🔴 ESP32/ESP32-S3 LED Light Sensor
==================================================
📡 使用ピン: GPIO18(充電) / GPIO19(センサー)
🔴 赤色LED必須
⚡ ESP32/ESP32-S3 両対応

🔧 GPIO動作テスト...
GPIO18: 設定=HIGH, 読み取り=1
GPIO19: 設定=LOW, 読み取り=0
✅ GPIO正常動作

📊 光センサー測定開始...
[  1] Light:  1500μs -> Bright
[  2] Light:  8500μs -> Dark          ← 手で覆った時
[  3] Light:   800μs -> Very Bright ☀️ ← スマホライト
```

### 代替ファイル
* `simple_test.py`: よりシンプルなテスト版
* `main_old_complex.py`: 高機能診断版（バックアップ）

### トラブルシューティング
プログラムが自動的にGPIOの動作を確認し、問題がある場合は代替ピンを提案します：
```
❌ GPIO問題あり
🔍 代替ピン検索中...
  ✅ GPIO2/15 動作OK!
  📝 配線を GPIO2(+) / GPIO15(-) に変更してください
```

## 仕組みの解説
このプログラムは、ADC（アナログ-デジタル変換器）を使わずに、デジタルピンの性質を利用して光の強度を測定します。

1.  **充電**: 片方のピンをHIGH、もう片方をLOWにして、LEDに逆電圧をかけます。これにより、LED内部の微小な静電容量が充電されます。
2.  **放電**: 両方のピンを入力モード（ハイインピーダンス）に切り替えます。すると、充電された電荷は、LEDに当たる光によって発生する微弱な電流（光電流）によってのみ放電されます。
3.  **測定**: ピンの電圧がHIGHからLOWに落ちるまでの時間をマイクロ秒単位で測定します。

**明るい場所ほど光電流が大きくなり、放電が速く進むため、測定される時間は短くなります。**

## なぜ抵抗が不要なのか？
通常、LEDを点灯させる回路では、過大な電流でLEDやマイコンのピンを破損しないように**電流制限抵抗が必須**です。

しかし、この光センサー回路では以下の理由で**抵抗は不要**です。

* **充電時**: LEDに**逆方向**の電圧をかけています。LEDは逆方向にはほとんど電流を流さないため、大電流が流れる心配がありません。
* **測定時**: ピンは入力モードになっており、ESP32から電流は供給されません。LED自身が光によって発生させる微弱な電流を測定しているだけです。

## プロジェクトの成果

### ✅ 実現できたこと
* **ESP32/ESP32-S3両対応**の光センサー
* **赤色LEDによる高感度測定**（1000μs～15000μsの測定範囲）
* **自動GPIO診断機能**（ハードウェア問題の自動検出）
* **リアルタイム光レベル表示**（明るさの段階表示）

### 📊 測定例（実測値）
```
室内蛍光灯:     1500μs -> Bright
薄暗い環境:     5000μs -> Dim
手で覆う:       8500μs -> Dark
完全な暗闇:    12000μs -> Very Dark 🌙
スマホライト:   800μs  -> Very Bright ☀️
```

### 🔧 技術的特徴
* **ADC不要**のデジタル測定方式
* **外部部品なし**（抵抗・コンデンサ不要）
* **マイクロ秒精度**の時間測定
* **自動エラー回復**機能

## 学習ポイント

このプロジェクトを通じて以下を学ぶことができます：
* **LED物理特性**の実践的理解
* **GPIO制御**の基本とトラブルシューティング
* **時間測定**とリアルタイム処理
* **ハードウェア診断**プログラミング
* **MicroPython**の実践的活用

このように、回路のどの段階でも大電流が流れることがないため、抵抗は必要ありません。
